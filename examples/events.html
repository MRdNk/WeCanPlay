<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>WeCanPlay - Ryu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Wecanplay">
    
    <link href="ressources/style/bootstrap.min.css" rel="stylesheet">
    <link href="ressources/style/wecanplay.css" rel="stylesheet">
    <script src="build-WCP.js"></script>
</head>
<body>
    <nav class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="http://www.wecanplay.fr/"><img src="ressources/style/logo_wecanplay.png" width="50" />WeCanPlay</a>
            <div class="nav-collapse">
            <ul class="nav">
                <li><a href="#">Ryu</a></li>
            </ul>
            </div><!--/.nav-collapse -->
        </div>
      </div>
    </nav>

    
    <div class="container">
        <div class="jumbotron subhead">
            <h1>Ryu</h1>
            <canvas id="canvas" style="background-color: #bcbcbc; zoom: 200%;"></canvas>
            <div class='well'>
                This demo allows you to see some of the different kind of events offered by WeCanPlay.
                <br/>
                Please try some of these attacks :
                <ul>
                    <li>Punch : p</li>
                    <li>Big Punch : left+p</li>
                    <li>Kick : k</li>
                    <li>Big Kick : right+k</li>
                    <li>Tatsumaki Senpuukyaku : down, left, k</li>
                    <li>Hadouken : down, right, p</li>
                </ul>
                It also uses our sprite module, as well as the assets and sound manager.
            </div>
       </div>
   </div>
        <script>
            (function() {
                var log = WCP.log;

                // Set Canvas and lib' options
                var cx = 200;
                var cy = 200;
                WCP.setCanvas("canvas", cx, cy);
                var canvas = document.getElementById("canvas");

                MyEventManager = function () {};
                WCP.EventTarget.extend(MyEventManager);
                var myEventManager = new MyEventManager();
                var soundManager = new WCP.SoundManager();
                myEventManager.listen();
                myEventManager.register(WCP.Animation);
                
                var key = null;
                var ryu;
                var lock = false;


                function punch () {
                    ryu.setAnimation("punch", 1);
                    soundManager.get('punch').play();
                }

                function bigPunch () {
                    ryu.setAnimation("bigPunch", 1);
                    soundManager.get('bigPunch').play();
                }

                function kick () {
                    ryu.setAnimation("kick", 1);
                    soundManager.get('punch').play();
                }

                function bigKick () {
                    ryu.setAnimation("bigKick", 1);
                    soundManager.get('bigKick').play();
                }

                function hadouken () {
                    ryu.setAnimation("hadouken", 1);
                    soundManager.get('hadouken').play();
                }

                function tatsumaki () {
                    soundManager.get('tatsumaki').play();
                    ryu.setAnimation('tatsumaki', 1, function() {
                        ryu.setAnimation('wait');
                    });
                }

                function setSpriteAnimation(params) {
                    var anim = [];                  
                    var x = params.startx;
                    var y = params.starty;
                    if (typeof params.xMove == 'undefined')
                        params.xMove = params.width;
                    if (typeof params.yMove == 'undefined')
                        params.yMove = params.height;
                    for (var i = 0; i < params.size; i++) {
                        anim.push({
                            x : x,
                            y : y,
                            width: params.width,
                            height: params.height
                        });
                        x += params.xMove;
                        y += params.yMove;
                    }
                    return anim;
                }

                // Create instance of imgManager
                WCP.Assets.add("ryu", "ressources/hadouken/evilryu.png");
                WCP.Assets.add({
                    path: 'ressources/hadouken/sound/',
                    assets: {
                        'hadouken': ['hadouken.mp3','hadouken.ogg'],
                        'tatsumaki': ['tatsumaki.mp3','tatsumaki.ogg'],
                        'kick': ['kick.mp3','kick.ogg'],
                        'bigKick': ['bigKick.mp3','bigKick.ogg'],
                        'punch': ['punch.mp3','punch.ogg'],
                        'bigPunch': ['bigPunch.mp3','bigPunch.ogg']                        
                    }
                });
                WCP.Assets.load('*', null, function() {
                    var animationSceneDefinition = {
                        init: function () {
                            soundManager.channel(WCP.Assets.get('hadouken'), {id: 'hadouken', autoplay: false, loop: false, volume: 100});
                            soundManager.channel(WCP.Assets.get('tatsumaki'), {id: 'tatsumaki', autoplay: false, loop: false, volume: 100});
                            soundManager.channel(WCP.Assets.get('bigPunch'), {id: 'bigPunch', autoplay: false, loop: false, volume: 100});
                            soundManager.channel(WCP.Assets.get('punch'), {id: 'punch', autoplay: false, loop: false, volume: 100});
                            soundManager.channel(WCP.Assets.get('kick'), {id: 'kick', autoplay: false, loop: false, volume: 100});
                            soundManager.channel(WCP.Assets.get('bigKick'), {id: 'bigKick', autoplay: false, loop: false, volume: 100});
                            ryu = new WCP.Sprite(WCP.Assets.get("ryu"), 80, 70);
                            ryu.setSlice(2, 9, 26, 38);
                            ryu.animations({
                                timeRate: 90,
                                wait: setSpriteAnimation({
                                    startx : 10,
                                    starty : 0,
                                    yMove : 0,
                                    width : 45,
                                    height : 48,
                                    size : 4,
                                }),
                                punch: [{
                                    x: 10,
                                    y: 60,
                                    width: 45,
                                    height: 48
                                },
                                {
                                    x: 55,
                                    y: 60,
                                    width: 55,
                                    height: 48
                                }],
                                bigPunch: [{
                                    x: 120,
                                    y: 60,
                                    width: 50,
                                    height: 48
                                },
                                {
                                    x: 170,
                                    y: 60,
                                    width: 45,
                                    height: 48
                                },
                                {
                                    x: 215,
                                    y: 60,
                                    width: 70,
                                    height: 48
                                }
                                ],
                                kick: [{
                                    x: 350,
                                    y: 60,
                                    width: 40,
                                    height: 48
                                },
                                {
                                    x: 390,
                                    y: 60,
                                    width: 60,
                                    height: 48
                                }],
                                bigKick: [{
                                    x: 260,
                                    y: 255,
                                    width: 45,
                                    height: 48
                                },
                                {
                                    x: 300,
                                    y: 255,
                                    width: 65,
                                    height: 48
                                },
                                {
                                    x: 365,
                                    y: 255,
                                    width: 60,
                                    height: 48
                                }
                                ],
                                hadouken : [{
                                    x: 10,
                                    y: 368,
                                    width: 45,
                                    height: 48
                                },
                                {
                                    x: 55,
                                    y: 368,
                                    width: 50,
                                    height: 48
                                },
                                {
                                    x: 120,
                                    y: 368,
                                    width: 60,
                                    height: 48
                                }],
                                tatsumaki : [{
                                    x: 10,
                                    y: 490,
                                    width: 40,
                                    height: 63
                                },
                                {
                                    x: 50,
                                    y: 490,
                                    width: 30,
                                    height: 70
                                },
                                {
                                    x: 80,
                                    y: 490,
                                    width: 55,
                                    height: 65
                                },
                                {
                                    x: 135,
                                    y: 490,
                                    width: 38,
                                    height: 63
                                },
                                {
                                    x: 135,
                                    y: 490,
                                    width: 38,
                                    height: 63
                                },
                                ]
                            });
                            ryu.setAnimation('wait');
                            myEventManager.keydown('k', kick);
                            myEventManager.keydown('p', punch);
                            myEventManager.combo('left p', bigPunch);
                            myEventManager.combo('right k', bigKick);
                            myEventManager.sequence('down right p', hadouken);
                            myEventManager.sequence('down left k', tatsumaki);
                        },
                        
                        loop: function () {

                        }
                    };
                                        
                    var animationScene = new WCP.View(animationSceneDefinition);
                    
                    animationScene.start();
                });
           })();
           </script>
    </body>
</html>
